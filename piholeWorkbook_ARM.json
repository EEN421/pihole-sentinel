# Deploy Pi-hole Sentinel Workbook using ARM template
# Change these values according to your environment
$subscriptionId = "<your-subscription-id>"
$resourceGroupName = "pihole-monitoring-rg"
$location = "eastus"
$workspaceName = "pihole-workspace"
$deploymentName = "pihole-workbook-deployment-$(Get-Date -Format 'yyyyMMddHHmmss')"
$templateFile = "arm-template.json"  # Path to the ARM template file

# Login to Azure (if not already logged in)
Connect-AzAccount

# Select the subscription
Select-AzSubscription -SubscriptionId $subscriptionId

# Create resource group if it doesn't exist
$resourceGroup = Get-AzResourceGroup -Name $resourceGroupName -ErrorAction SilentlyContinue
if (!$resourceGroup) {
    Write-Host "Creating resource group '$resourceGroupName' in location '$location'..."
    New-AzResourceGroup -Name $resourceGroupName -Location $location
}

# Deploy the template
Write-Host "Deploying Pi-hole Sentinel Workbook..."
New-AzResourceGroupDeployment `
    -Name $deploymentName `
    -ResourceGroupName $resourceGroupName `
    -TemplateFile $templateFile `
    -workspaceName $workspaceName `
    -location $location `
    -Verbose

Write-Host "Deployment completed."
